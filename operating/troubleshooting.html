

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Troubleshooting &mdash; MagAO-X Instrument Handbook  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/stats.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Handling Procedures" href="../handling/index.html" />
    <link rel="prev" title="logdump" href="software/utils/logdump.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/magao-x_logo_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../observers/index.html">Information For Observers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Operation of the MagAO-X instrument</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="software/index.html">Instrument Software</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#missing-gpus-on-rtc">Missing GPUs on RTC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ocam-connectivity-bad-data">OCAM connectivity / bad data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alpao-dm-not-responding">Alpao DM not responding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting-a-magao-x-app-that-won-t-start">Troubleshooting a MagAO-X app that won’t start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#edt-framegrabber-problems-camwfs-and-camlowfs">EDT Framegrabber Problems (camwfs and camlowfs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#killing-indi-zombies">killing indi zombies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#difficulties-with-nvidia-proprietary-drivers">Difficulties with NVIDIA proprietary drivers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../handling/index.html">Handling Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compute/index.html">Compute System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/index.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MagAO-X Instrument Handbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Operation of the MagAO-X instrument</a> &raquo;</li>
        
      <li>Troubleshooting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/operating/troubleshooting.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="missing-gpus-on-rtc">
<h2>Missing GPUs on RTC<a class="headerlink" href="#missing-gpus-on-rtc" title="Permalink to this headline">¶</a></h2>
<p>Sometimes the RTC comes up with only one GPU (missing the two on an expansion board). This is due to a weird interaction between the expansion board and the motherboard. To resolve:</p>
<ol class="simple">
<li><p>If RTC is responding, bring it down cleanly (<code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">-h</span> <span class="pre">now</span></code>)</p></li>
<li><p>Power down RTC at PDU0 (e.g. with <code class="docutils literal notranslate"><span class="pre">pwrGUI</span></code>)</p></li>
<li><p>Wait 10 seconds before attempting to power back on</p></li>
<li><p>Once it boots (which can take several minutes, with apparent false-starts), run <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code> three times. It’ll likely die on the second (and lock up).</p></li>
<li><p>Reset using the switch mounted on the RTC motherboard (or the to-be-installed remote reset switch)</p></li>
<li><p>Repeatedly run <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">watch</span> <span class="pre">nvidia-smi</span></code>) to verify it’s back up and stable</p></li>
</ol>
</div>
<div class="section" id="ocam-connectivity-bad-data">
<h2>OCAM connectivity / bad data<a class="headerlink" href="#ocam-connectivity-bad-data" title="Permalink to this headline">¶</a></h2>
<p>OCAM connects over two CameraLink connections. CameraLink #1 carries serial communication with the detector, so if you’re able to command the camera but your data appear bad in <code class="docutils literal notranslate"><span class="pre">rtimv</span> <span class="pre">camwfs</span></code>, the culprit is likely the CameraLink #2 cable. Reseat, on ICC do <code class="docutils literal notranslate"><span class="pre">magaox</span> <span class="pre">restart</span> <span class="pre">camwfs</span></code>, and restart <code class="docutils literal notranslate"><span class="pre">rtimv</span></code>.</p>
</div>
<div class="section" id="alpao-dm-not-responding">
<h2>Alpao DM not responding<a class="headerlink" href="#alpao-dm-not-responding" title="Permalink to this headline">¶</a></h2>
<p>Make sure it has been initialized. There is an <code class="docutils literal notranslate"><span class="pre">initialize_alpao</span></code> systemd unit that runs at boot and initializes the interface card. Successful execution looks like this in <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">initialize_alpao</span></code> output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ systemctl status initialize_alpao
● initialize_alpao.service - Initialize Alpao interface card
   Loaded: loaded (/opt/MagAOX/config/initialize_alpao.service; enabled; vendor preset: disabled)
   Active: active (exited) since Sun 2019-09-29 11:18:34 MST; 20min ago
  Process: 4449 ExecStart=/opt/MagAOX/config/initialize_alpao.sh (code=exited, status=0/SUCCESS)
 Main PID: 4449 (code=exited, status=0/SUCCESS)
   CGroup: /system.slice/initialize_alpao.service

Sep 29 11:18:34 exao3.as.arizona.edu systemd[1]: Started Initialize Alpao interface card.
Sep 29 11:18:35 exao3.as.arizona.edu initialize_alpao.sh[4449]: ====================================================================
Sep 29 11:18:35 exao3.as.arizona.edu initialize_alpao.sh[4449]: Ref.ID | Model                          | RSW1 |  Type | Device No.
Sep 29 11:18:35 exao3.as.arizona.edu initialize_alpao.sh[4449]: --------------------------------------------------------------------
Sep 29 11:18:35 exao3.as.arizona.edu initialize_alpao.sh[4449]: 1 | PEX-292144                     |    0 |    DI |    17
Sep 29 11:18:35 exao3.as.arizona.edu initialize_alpao.sh[4449]: --------------------------------------------------------------------
Sep 29 11:18:35 exao3.as.arizona.edu initialize_alpao.sh[4449]: 2 | PEX-292144                     |    0 |    DO |    18
Sep 29 11:18:35 exao3.as.arizona.edu initialize_alpao.sh[4449]: ====================================================================
</pre></div>
</div>
<p>The script is saved at <code class="docutils literal notranslate"><span class="pre">/opt/MagAOX/config/initialize_alpao.sh</span></code>, if you want to see what it’s doing. Note that executing it again will appear to fail with a message about not finding cards to initialize if the cards have been previously initialized.</p>
</div>
<div class="section" id="troubleshooting-a-magao-x-app-that-won-t-start">
<h2>Troubleshooting a MagAO-X app that won’t start<a class="headerlink" href="#troubleshooting-a-magao-x-app-that-won-t-start" title="Permalink to this headline">¶</a></h2>
<p>The typical MagAO-X app is started by <code class="docutils literal notranslate"><span class="pre">magaox</span> <span class="pre">startup</span></code> based on a line in a config file in <code class="docutils literal notranslate"><span class="pre">/opt/MagAOX/config/proclist_$MAGAOX_ROLE.txt</span></code>. This proclist determines which application to start and which config file from <code class="docutils literal notranslate"><span class="pre">/opt/MagAOX/config</span></code> should be supplied as the <code class="docutils literal notranslate"><span class="pre">-n</span></code> option (see <a class="reference external" href="#standard-options">Standard options</a>). It also uses <code class="docutils literal notranslate"><span class="pre">sudo</span></code> to run the process as user <code class="docutils literal notranslate"><span class="pre">xsup</span></code>, regardless of which user called <code class="docutils literal notranslate"><span class="pre">magaox</span> <span class="pre">startup</span></code>.</p>
<p>Many, if not all, MagAO-X apps are intended to run “forever” (i.e until shutdown). Obviously, if the process exits early, that’s cause for concern. To interrogate the list of running processes, use <code class="docutils literal notranslate"><span class="pre">magaox</span> <span class="pre">status</span></code>. To attempt a restart, you can attach to the <code class="docutils literal notranslate"><span class="pre">tmux</span></code> session that’s the parent of the process in question with <code class="docutils literal notranslate"><span class="pre">magaox</span> <span class="pre">inspect</span> <span class="pre">PROCNAME</span></code> (where <code class="docutils literal notranslate"><span class="pre">PROCNAME</span></code> is the name of the failed process).</p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">trippLitePDU</span></code> is started by <code class="docutils literal notranslate"><span class="pre">magaox</span> <span class="pre">startup</span></code> with config specified by <code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">pdu0</span></code> and there’s a syntax error in <code class="docutils literal notranslate"><span class="pre">/opt/MagAOX/config/pdu0.conf</span></code> preventing startup, you can attach to the tmux session with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>yourlogin$ magaox inspect pdu0
</pre></div>
</div>
<p>The errors before exit, if any, will be in the log. The last few lines of the log are shown in <code class="docutils literal notranslate"><span class="pre">magaox</span> <span class="pre">status</span></code> output, or you can do <code class="docutils literal notranslate"><span class="pre">logdump</span> <span class="pre">-f</span> <span class="pre">pdu0</span></code>.</p>
<p>The command that started the app will be of the form <code class="docutils literal notranslate"><span class="pre">/opt/MagAOX/bin/$appName</span> <span class="pre">-n</span> <span class="pre">$configName</span></code>. You can use the up-arrow key in the tmux session to retrieve it from the shell history and try to relaunch once you’ve corrected whatever error was preventing startup.</p>
</div>
<div class="section" id="edt-framegrabber-problems-camwfs-and-camlowfs">
<h2>EDT Framegrabber Problems (camwfs and camlowfs)<a class="headerlink" href="#edt-framegrabber-problems-camwfs-and-camlowfs" title="Permalink to this headline">¶</a></h2>
<p>The EDT PCIe framegrabber occassionally stops responding.  The main symptom of this is no data from <code class="docutils literal notranslate"><span class="pre">camwfs</span></code>, and no response on the serial over camera link.  This has not yet been observed on <code class="docutils literal notranslate"><span class="pre">camlowfs</span></code> (which does not use serial over C.L.).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">camwfs</span></code> (or any EDT camera) stops responding on serial, first shutdown the controlling application.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ magaox inspect camwfs
&lt;Ctrl-C&gt;
</pre></div>
</div>
<p>then do these steps as root:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ modprobe -r edt
$ cd /opt/EDTpdv
$ ./edt_load
</pre></div>
</div>
<p>This will reset the kernel module and restore operation.  Now restart the controlling application by returning to the tmux session, up-arrow to find the command, and press enter.</p>
</div>
<div class="section" id="killing-indi-zombies">
<h2>killing indi zombies<a class="headerlink" href="#killing-indi-zombies" title="Permalink to this headline">¶</a></h2>
<p>If the <code class="docutils literal notranslate"><span class="pre">indiserver</span></code> crashes uncleanly (itself a subprocess of <code class="docutils literal notranslate"><span class="pre">xindiserver</span></code>), the associated <code class="docutils literal notranslate"><span class="pre">xindidriver</span></code> processes may become orphans.  This will prevent <code class="docutils literal notranslate"><span class="pre">xindiserver</span></code> from starting gain until these processes have been killed.  The following shell command will kill them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kill $(ps -elf | awk &#39;{if ($5 == 1){print $4&quot; &quot;$5&quot; &quot;$15}}&#39; | grep MagAOX/drivers | awk &#39;{print $1}&#39;)
</pre></div>
</div>
<p>To check if any remain use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ps -elf | awk &#39;{if ($5 == 1){print $4&quot; &quot;$5&quot; &quot;$15}}&#39; | grep MagAOX/drivers
</pre></div>
</div>
</div>
<div class="section" id="difficulties-with-nvidia-proprietary-drivers">
<h2>Difficulties with NVIDIA proprietary drivers<a class="headerlink" href="#difficulties-with-nvidia-proprietary-drivers" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>When installing, ensure you have <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">set-default</span> <span class="pre">multi-user.target</span></code> and a display is connected <strong>only</strong> to the VGA header provided by the motherboard</p></li>
<li><p>If NVIDIA graphical output did work, and now doesn’t: Your kernel may have been updated, requiring a rebuild of the NVIDIA driver. Having <code class="docutils literal notranslate"><span class="pre">dkms</span></code> installed <em>should</em> prevent needing to do this, but an uninstall and reinstall over SSH will also remedy it.</p></li>
<li><p>Runfile installs can be uninstalled with <code class="docutils literal notranslate"><span class="pre">/usr/local/cuda/bin/cuda-uninstaller</span></code></p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../handling/index.html" class="btn btn-neutral float-right" title="Handling Procedures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="software/utils/logdump.html" class="btn btn-neutral float-left" title="logdump" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Extreme Wavefront Control Lab, The University of Arizona

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>